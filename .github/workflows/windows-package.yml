name: Windows Package

"on":
  workflow_dispatch:
  push:
    tags:
      - "v*"

permissions:
  contents: read

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Setup uv
        uses: astral-sh/setup-uv@v3

      - name: Sync dependencies
        run: uv sync --dev

      - name: Build with existing script
        shell: cmd
        run: scripts\build.bat

      - name: Pack artifact zip
        shell: pwsh
        run: |
          $Name = "MaterialUpper"
          $DistDir = "dist/$Name"
          if (-not (Test-Path $DistDir)) {
            throw "Build output not found: $DistDir"
          }
          Compress-Archive -Path "$DistDir/*" -DestinationPath "dist/$Name-windows.zip" -Force

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: MaterialUpper-windows
          path: |
            dist/MaterialUpper-windows.zip
            dist/MaterialUpper/**
